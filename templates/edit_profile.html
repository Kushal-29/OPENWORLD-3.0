{% extends "base.html" %}

{% block title %}Edit Profile - OPENWORLD{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto;">
    
    <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 32px; letter-spacing: -1px;">Edit Profile</h1>

    <form method="POST" enctype="multipart/form-data">
        
        <!-- PROFILE PICTURE -->
        <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 700;">Profile Picture</h3>
            
            <div style="display: flex; gap: 20px; align-items: flex-start;">
                <div class="profile-avatar" style="width: 120px; height: 120px;">
                    <img id="previewImg"
                         src="/static/uploads/profiles/{{ user.profile_pic }}" 
                         alt="Profile"
                         onerror="this.src='/static/uploads/profiles/default.png'"
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">
                </div>

                <div style="flex: 1;">
                    <input type="file" 
                           id="profilePic"
                           name="profile_pic"
                           accept="image/png,image/jpeg,image/gif,image/webp"
                           onchange="previewImage(event)">
                    
                    <label for="profilePic" class="btn btn-secondary" style="display: inline-block; margin-top: 12px; cursor: pointer; padding: 10px 20px;">
                        Choose Image
                    </label>

                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 12px;">
                        PNG, JPG, GIF or WEBP ‚Ä¢ Max 5MB
                    </p>
                </div>
            </div>
        </div>

        <!-- BASIC INFO -->
        <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 700;">Basic Information</h3>

            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" 
                       id="fullName"
                       name="full_name"
                       value="{{ user.full_name or '' }}"
                       placeholder="Your full name"
                       maxlength="100">
            </div>

            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" 
                       id="email"
                       name="email"
                       value="{{ user.email or '' }}"
                       placeholder="your@email.com"
                       maxlength="120">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                    <label for="age">Age</label>
                    <input type="number" 
                           id="age"
                           name="age"
                           value="{{ user.age or '' }}"
                           placeholder="Your age"
                           min="13"
                           max="120">
                </div>

                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" style="width: 100%; padding: 10px; border: 1px solid var(--border-primary); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                        <option value="">Prefer not to say</option>
                        <option value="male" {% if user.gender == 'male' %}selected{% endif %}>Male</option>
                        <option value="female" {% if user.gender == 'female' %}selected{% endif %}>Female</option>
                        <option value="other" {% if user.gender == 'other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                    <label for="country">Country</label>
                    <input type="text" 
                           id="country"
                           name="country"
                           value="{{ user.country or '' }}"
                           placeholder="Your country"
                           maxlength="100">
                </div>

                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" 
                           id="city"
                           name="city"
                           value="{{ user.city or '' }}"
                           placeholder="Your city"
                           maxlength="100">
                </div>
            </div>
        </div>

        <!-- INTERESTS -->
        <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 700;">Interests</h3>

            <div class="form-group">
                <label for="interests">Your Interests</label>
                <input type="text" 
                       id="interests"
                       name="interests"
                       value="{{ user.get_interests_list() | join(', ') if user.interests else '' }}"
                       placeholder="e.g. gaming, music, sports, travel"
                       maxlength="300">
                
                <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                    üí° Separate interests with commas
                </div>
            </div>
        </div>

        <!-- BIO -->
        <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 700;">About You</h3>

            <div class="form-group">
                <label for="bio">Bio</label>
                <textarea id="bio"
                          name="bio"
                          placeholder="Tell us about yourself..."
                          maxlength="300"
                          style="min-height: 100px; resize: vertical; width: 100%; padding: 10px; border: 1px solid var(--border-primary); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">{{ user.bio or '' }}</textarea>
                
                <div style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                    <span id="bioCount">{{ user.bio|length if user.bio else 0 }}</span>/300 characters
                </div>
            </div>
        </div>

        <!-- BUTTONS -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px;">
            <button type="submit" class="btn btn-success" style="flex: 1; padding: 14px; font-weight: 700;">
                ‚úÖ Save Changes
            </button>

            <a href="{{ url_for('profile.my_profile') }}" class="btn btn-secondary" style="flex: 1; padding: 14px; text-align: center; text-decoration: none; font-weight: 700;">
                ‚ùå Cancel
            </a>
        </div>

    </form>

</div>

<script>
    function previewImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImg').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    const bioTextarea = document.getElementById('bio');
    const bioCount = document.getElementById('bioCount');
    
    if (bioTextarea && bioCount) {
        bioTextarea.addEventListener('input', function() {
            bioCount.textContent = this.value.length;
        });
    }
</script>
{% endblock %}